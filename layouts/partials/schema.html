{{- $brand := site.Data.site.brand.name | default site.Title -}}

{{- $page := .Title -}}
{{- $title := $brand -}}
{{- with .Params.seo_title -}}
  {{- $title = . -}}
{{- else -}}
  {{- if and (not .IsHome) $page -}}
    {{- $title = printf "%s | %s" $page $brand -}}
  {{- end -}}
{{- end -}}

{{- $url := .Site.BaseURL -}}
{{- $logo := (site.Data.site.brand.logo | default "/images/logo.jpg") | absURL -}}

{{- $tel := site.Data.site.brand.phone | default (site.Params.phone | default "") -}}
{{- $street := site.Data.site.brand.streetAddress | default (site.Params.streetAddress | default "") -}}
{{- $locality := site.Data.site.brand.addressLocality | default (site.Params.addressLocality | default "") -}}
{{- $postal := site.Data.site.brand.postalCode | default (site.Params.postalCode | default "") -}}
{{- $country := site.Data.site.brand.addressCountry | default (site.Params.addressCountry | default "GB") -}}

{{- $lat := site.Data.site.brand.geo.latitude | default "" -}}
{{- $lng := site.Data.site.brand.geo.longitude | default "" -}}

{{- $instagram := site.Data.site.brand.social.instagram | default site.Params.social.instagram | default "" -}}
{{- $facebook := site.Data.site.brand.social.facebook | default site.Params.social.facebook | default "" -}}

{{- $reservation := site.Data.site.links.reservation_url | default site.Data.site.brand.reservation_url | default "" -}}

{{- /* default share image: page og_image -> site brand og_image -> /images/og.jpg if exists -> logo */ -}}
{{- $og := "" -}}
{{- with .Params.og_image -}}
  {{- $og = . -}}
{{- else -}}
  {{- with site.Data.site.brand.og_image -}}
    {{- $og = . -}}
  {{- else -}}
    {{- if (fileExists "static/images/og.jpg") -}}
      {{- $og = "/images/og.jpg" -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- if $og -}}
  {{- $og = $og | absURL -}}
{{- end -}}

{{- $img := (cond (ne $og "") $og $logo) -}}

{{- $spec := site.Data.site.brand.openingHoursSpec | default (slice) -}}
{{- $ohText := site.Data.site.brand.openingHoursText | default (slice) -}}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "{{ $url }}#organization",
      "name": "{{ $brand }}",
      "url": "{{ $url }}",
      "logo": { "@type": "ImageObject", "url": "{{ $logo }}" }
      {{- if or $instagram $facebook -}},
      "sameAs": [
        {{- $first := true -}}
        {{- if $instagram -}}{{- if not $first -}},{{- end -}}"{{ $instagram }}"{{- $first = false -}}{{- end -}}
        {{- if $facebook -}}{{- if not $first -}},{{- end -}}"{{ $facebook }}"{{- $first = false -}}{{- end -}}
      ]
      {{- end -}}
    },
    {
      "@type": "WebSite",
      "@id": "{{ $url }}#website",
      "url": "{{ $url }}",
      "name": "{{ $brand }}",
      "publisher": { "@id": "{{ $url }}#organization" }
    },
    {
      "@type": "WebPage",
      "@id": "{{ .Permalink }}#webpage",
      "url": "{{ .Permalink }}",
      "name": "{{ $title }}",
      "isPartOf": { "@id": "{{ $url }}#website" },
      "about": { "@id": "{{ $url }}#organization" }
      {{- if $og -}},
      "primaryImageOfPage": { "@type": "ImageObject", "url": "{{ $og }}" }
      {{- end -}}
    },
    {
      "@type": "Restaurant",
      "@id": "{{ $url }}#restaurant",
      "name": "{{ $brand }}",
      "url": "{{ $url }}",
      "image": "{{ $img }}",
      "servesCuisine": "Japanese",
      "priceRange": "££"
      {{- if $tel -}},
      "telephone": "{{ $tel }}"
      {{- end -}},
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "{{ $street }}",
        "addressLocality": "{{ $locality }}",
        "postalCode": "{{ $postal }}",
        "addressCountry": "{{ $country }}"
      }
      {{- if and $lat $lng -}},
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "{{ $lat }}",
        "longitude": "{{ $lng }}"
      }
      {{- end -}}

      {{- /* strict openingHoursSpecification */ -}}
      {{- if gt (len $spec) 0 -}},
      "openingHoursSpecification": [
        {{- $firstSpec := true -}}
        {{- range $spec -}}
          {{- $day := .dayOfWeek | default "" -}}
          {{- $closed := .closed | default false -}}
          {{- $opens := .opens | default "" -}}
          {{- $closes := .closes | default "" -}}

          {{- if $day -}}
            {{- if not $firstSpec -}},{{ end -}}
            {{- $firstSpec = false -}}
            {
              "@type": "OpeningHoursSpecification",
              "dayOfWeek": "https://schema.org/{{ $day }}"
              {{- if $closed -}},
              "opens": "00:00",
              "closes": "00:00"
              {{- else -}}
                {{- if and $opens $closes -}},
                "opens": "{{ $opens }}",
                "closes": "{{ $closes }}"
                {{- end -}}
              {{- end -}}
            }
          {{- end -}}
        {{- end -}}
      ]
      {{- else if gt (len $ohText) 0 -}},
      "openingHours": [
        {{- range $i, $line := $ohText -}}
          {{- if $i }},{{ end -}}
          "{{ $line }}"
        {{- end -}}
      ]
      {{- end -}}

      {{- if $reservation -}},
      "acceptsReservations": "{{ $reservation }}",
      "potentialAction": {
        "@type": "ReserveAction",
        "target": "{{ $reservation }}"
      }
      {{- end -}}
    }
  ]
}
</script>